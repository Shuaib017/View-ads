<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h2>Welcome to Telegram Mini App</h2>
    <p id="username">Loading...</p>

    <!-- পয়েন্ট এবং বাটনের জন্য ডিভ, যা শর্ত সাপেক্ষে দেখানো হবে -->
    <div id="point-section" style="display: none;">
        <p>Points: <span id="points">0</span></p>
        <button id="increment-btn">Add Point</button>
    </div>

    <script>
        // টেলিগ্রাম মিনি অ্যাপ সাপোর্ট চেক এবং প্রস্তুত করুন
        window.Telegram.WebApp.ready();

        // ব্যবহারকারীর তথ্য লোড করুন
        const user = window.Telegram.WebApp.initDataUnsafe.user;
        let points = 0;

        // ইউজারনেম পাওয়া গেলে সেটি দেখান এবং পয়েন্ট সেকশন সক্রিয় করুন
        if (user && user.username) {
            document.getElementById("username").innerText = `Your username: @${user.username}`;
            document.getElementById("point-section").style.display = "block"; // পয়েন্ট এবং বাটন সেকশন দেখান
        } else {
            document.getElementById("username").innerText = "Username not available.";
        }

        // পয়েন্ট বৃদ্ধি এবং MongoDB তে আপডেটের জন্য ইভেন্ট হ্যান্ডলার
        document.getElementById("increment-btn").addEventListener("click", async function () {
            points += 1;
            document.getElementById("points").innerText = points;

            // MongoDB তে পয়েন্ট আপডেট করার জন্য API কল
            try {
                await fetch("http://localhost:3000/update-points", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        username: user.username,
                        points: points
                    })
                });
                console.log("Points updated successfully!");
            } catch (error) {
                console.error("Failed to update points:", error);
            }
        });
    </script>
</body>
</html>
